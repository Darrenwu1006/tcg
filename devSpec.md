## devSpec

## TypeScript ä»£ç¢¼å„ªåŒ–é …ç›® (Code Optimization Tasks)

> ğŸ“… **å¯©æŸ¥æ—¥æœŸ**: 2025-12-05  
> ğŸ“Š **å¯©æŸ¥ç¯„åœ**: æ‰€æœ‰ TS æ–‡ä»¶ (13 å€‹æ–‡ä»¶)  
> ğŸ¯ **ç›®æ¨™**: æå‡ä»£ç¢¼å¯ç¶­è­·æ€§ã€æ€§èƒ½å’Œé¡å‹å®‰å…¨

### ğŸ”´ é«˜å„ªå…ˆç´š (Critical Priority)

#### 1. **æ•¸æ“šçµæ§‹é‡è¤‡å®šç¾©å•é¡Œ**

- **æ–‡ä»¶**: `src/state/Store.ts`
- **å•é¡Œ**:
  - `Card` ä»‹é¢åŒæ™‚å®šç¾©äº† `stats` å°è±¡å’Œå¯èƒ½çš„å¹³é¢å±¬æ€§
  - `PlayerState` æœ‰ `currentStats` ä½† Card ä¹Ÿæœ‰ `stats`ï¼Œçµæ§‹ä¸ä¸€è‡´
- **å½±éŸ¿**: é¡å‹æª¢æŸ¥æ··äº‚ï¼Œå¯èƒ½å°è‡´é‹è¡Œæ™‚éŒ¯èª¤
- **å»ºè­°**: çµ±ä¸€æ•¸æ“šçµæ§‹ï¼Œæ±ºå®šä½¿ç”¨åµŒå¥—å°è±¡é‚„æ˜¯å¹³é¢å±¬æ€§
- **å·¥ä½œé‡**: 1-2 å°æ™‚

#### 2. **é‡è¤‡çš„å·¥å…·å‡½æ•¸ - renderBlockBar**

- **æ–‡ä»¶**:
  - `src/components/Card.ts` (Line 49-65, maxBlocks=6)
  - `src/components/CardDetailPanel.ts` (Line 173-189, maxBlocks=5)
- **å•é¡Œ**: å¹¾ä¹ç›¸åŒçš„å‡½æ•¸åœ¨å…©å€‹åœ°æ–¹å®šç¾©
- **å½±éŸ¿**: ç¶­è­·å›°é›£ï¼ŒåŒ…å¤§å°å¢åŠ 
- **å»ºè­°**: æå–åˆ° `src/utils/renderHelpers.ts`
- **å·¥ä½œé‡**: 30 åˆ†é˜

#### 3. **å­¸æ ¡åç¨±æ˜ å°„é‡è¤‡**

- **æ–‡ä»¶**: `src/components/Card.ts` (Line 9-24)
- **å•é¡Œ**: `getSchoolClass` å‡½æ•¸å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦
- **å½±éŸ¿**: æ·»åŠ æ–°å­¸æ ¡æ™‚å®¹æ˜“éºæ¼
- **å»ºè­°**: æå–ç‚º `src/constants/schools.ts` ä¸­çš„æ˜ å°„è¡¨
- **å·¥ä½œé‡**: 30 åˆ†é˜

### ğŸŸ¡ ä¸­å„ªå…ˆç´š (Medium Priority)

#### 4. **PlayerZone.ts æ–‡ä»¶éå¤§**

- **æ–‡ä»¶**: `src/components/PlayerZone.ts` (1444 è¡Œ, 47KB)
- **å•é¡Œ**:
  - å–®å€‹æ–‡ä»¶åŒ…å«å¤ªå¤šè·è²¬
  - `setupGlobalDragSelection` (150 è¡Œ)
  - `renderExpandedOverlay` (252 è¡Œ)
  - å¤šå€‹æ›´æ–°å‡½æ•¸
- **å½±éŸ¿**: é›£ä»¥ç¶­è­·ã€æ¸¬è©¦å’Œå°èˆª
- **å»ºè­°**: æ‹†åˆ†ç‚ºå¤šå€‹æ–‡ä»¶:
  - `PlayerZone.ts` (ä¸»é‚è¼¯)
  - `DragSelection.ts` (æ‹–æ‹½é¸æ“‡é‚è¼¯)
  - `ExpandedOverlay.ts` (å±•é–‹è¦–åœ–)
  - `CardUpdaters.ts` (å¡ç‰‡æ›´æ–°é‚è¼¯)
- **å·¥ä½œé‡**: 3-4 å°æ™‚

#### 5. **æœªä½¿ç”¨çš„ç‹€æ…‹å±¬æ€§**

- **æ–‡ä»¶**: `src/state/Store.ts` (Line 43)
- **å•é¡Œ**: `count: number` ä¼¼ä¹æœªè¢«ä½¿ç”¨
- **å½±éŸ¿**: ä½”ç”¨å…§å­˜ï¼Œæ··æ·†é–‹ç™¼è€…
- **å»ºè­°**: é©—è­‰å¾Œç§»é™¤æˆ–æ·»åŠ è¨»é‡‹èªªæ˜ç”¨é€”
- **å·¥ä½œé‡**: 15 åˆ†é˜

#### 6. **äº‹ä»¶ç›£è½å™¨é‡è¤‡ç¶å®š**

- **æ–‡ä»¶**: `src/components/PlayerZone.ts` - `setupGlobalDragSelection`
- **å•é¡Œ**:
  - æ¯å€‹ PlayerZone å¯¦ä¾‹éƒ½æœƒç¶å®š document ç´šåˆ¥çš„äº‹ä»¶
  - å‰µå»ºå…©å€‹å¯¦ä¾‹(me & opponent)å°è‡´ç›£è½å™¨é‡è¤‡
- **å½±éŸ¿**: æ€§èƒ½ä¸‹é™ï¼Œå¯èƒ½çš„å…§å­˜æ´©æ¼
- **å»ºè­°**: å°‡å…¨å±€ç›£è½å™¨ç§»åˆ° `GameBoard` æˆ– `main.ts`
- **å·¥ä½œé‡**: 1-2 å°æ™‚

### ğŸŸ¢ ä½å„ªå…ˆç´š (Low Priority)

#### 7. **éåº¦ä½¿ç”¨é¡å‹æ–·è¨€ (as any)**

- **æ–‡ä»¶**: `src/components/PlayerZone.ts` (å¤šè™•)
- **å•é¡Œ**: ä½¿ç”¨ `as any` ç¹éé¡å‹æª¢æŸ¥
- **å½±éŸ¿**: å¤±å» TypeScript é¡å‹å®‰å…¨å„ªå‹¢
- **å»ºè­°**: é‡æ§‹ç‹€æ…‹æ›´æ–°é‚è¼¯ï¼Œä½¿ç”¨æ­£ç¢ºçš„é¡å‹
- **å·¥ä½œé‡**: 2-3 å°æ™‚

#### 8. **Magic Numbers ç¡¬ç·¨ç¢¼**

- **ä½ç½®**:
  - `Store.ts` Line 74: `MAX_HISTORY = 20`
  - `Store.ts` Line 130: `slice(0, 50)` (logs ä¸Šé™)
  - `Card.ts` Line 51: `maxBlocks = 6`
  - `CardDetailPanel.ts` Line 175: `maxBlocks = 5`
- **å»ºè­°**: æå–ç‚ºé…ç½®å¸¸é‡ (`src/constants/config.ts`)
- **å·¥ä½œé‡**: 30 åˆ†é˜

#### 9. **CSS Class å­—ç¬¦ä¸²ç¡¬ç·¨ç¢¼**

- **æ–‡ä»¶**: æ‰€æœ‰çµ„ä»¶æ–‡ä»¶
- **å•é¡Œ**: CSS class åç¨±æ•£è½åœ¨ä»£ç¢¼å„è™•
- **å»ºè­°**: ä½¿ç”¨å¸¸é‡æˆ–æšèˆ‰é›†ä¸­ç®¡ç†
- **å·¥ä½œé‡**: 1-2 å°æ™‚

---

### âœ… å·²ç¢ºèªçš„è‰¯å¥½å¯¦è¸

- âœ… ä½¿ç”¨ TypeScript æ¥å£å®šç¾©
- âœ… å¯¦ç¾ Store æ¨¡å¼é€²è¡Œç‹€æ…‹ç®¡ç†
- âœ… çµ„ä»¶è·è²¬ç›¸å°æ¸…æ™°
- âœ… ä½¿ç”¨ Singleton æ¨¡å¼ (CardDatabase)
- âœ… å¯¦ç¾æ­·å²è¨˜éŒ„åŠŸèƒ½ (undo)
- âœ… è‰¯å¥½çš„è¨‚é–±/é€šçŸ¥æ¨¡å¼

---
